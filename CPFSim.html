<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>

<style>
    @media (min-width: 1200px) {
    .container{
        max-width: 930px;
    }
    .chart-container {
    width: 100%;  /* Set the width of the parent container to 100% */
    height: 100%;  /* Set the height of the parent container to 100% */
  }
}

</style>
<script>

function toFixed(value, preci) 
{
  	var precision = preci || 0,
    	power = Math.pow(10, precision),
    	absValue = Math.abs(Math.round(value * power)),
    	result = (value < 0 ? '-' : '') + String(Math.floor(absValue / power));

  	if (precision > 0) {
    	var fraction = String(absValue % power),
      	padding = new Array(Math.max(precision - fraction.length, 0) + 1).join('0');
    	result += '.' + padding + fraction;
  	}
  	return result;
}

function getRandomColor() 
{
  	var letters = '0123456789ABCDEF';
  	var color = '#';
  	for (var i = 0; i < 6; i++) 
    {
    	color += letters[Math.floor(Math.random() * 16)];
  	}
  	return color;
}


const RetirementAge = 65;
const CONST_SALARY_CAP = 6000.0;
    
// Get the allocation rate based on age.
function getAllocationRate(age) 
{
	if (age < 35) return [0.23, 0.06, 0.08];
	if (age >= 35 && age < 45) return [0.21, 0.07, 0.09];
	if (age >= 45 && age < 50) return [0.19, 0.08, 0.10];
	if (age >= 50 && age < 55) return [0.15, 0.115, 0.105];
	if (age >= 55 && age < 60) return [0.12, 0.035, 0.105];
	if (age >= 60 && age < 65) return [0.035, 0.025, 0.105];
	if (age >= 65) return [0.01, 0.01, 0.105];
} 

function getContrib(age, sal)
{
	var allocRate = getAllocationRate(age);
	return [sal > CONST_SALARY_CAP ? allocRate[0] * CONST_SALARY_CAP : allocRate[0] * sal,
        sal > CONST_SALARY_CAP ? allocRate[1] * CONST_SALARY_CAP : allocRate[1] * sal,
        sal > CONST_SALARY_CAP ? allocRate[2] * CONST_SALARY_CAP : allocRate[2] * sal,
        0.0];
}

var logtext = "";
var WRITE_LOG = true;
function log(v)
{
	if(WRITE_LOG)
    {
		logtext = logtext + v + "<br>";
    }
}

var data_collection_array = new Array();
var name_array = new Array();
var chart_total_balances = null;
var chart_doughnut1 = null;
var chart_doughnut2 = null;
// var myform = null;

function MAToSATransfer(age, balance, currentBHS, currentFRS, tfr)
{
    if(balance[2] > currentBHS)
    {       
        var amt = balance[2] - currentBHS;
        if(age < 55)
        {
             if(balance[1] < currentFRS)
             {
                // transfer to special account.
                balance[1] += amt;
                balance[2] -= amt;
                tfr[1] += amt;
                tfr[2] -= amt;
                if(balance[1] > currentFRS)
                {
                    // more than FRS amount transfer to ordinary account.
                    amt = balance[1] - currentFRS;
                    balance[1] = currentFRS;
                    balance[0] += amt;
                    
                    tfr[1] -= amt;
                    tfr[0] += amt;
                }
             }
             else
             {
                // transfer to ordinary.
                balance[0] += amt;
                balance[2] -= amt;
                tfr[0] += amt; 
                tfr[2] -= amt;                       
             }
        }
        else
        {
             if(balance[3] < currentFRS)
             {
                // transfer to retirement account.
                balance[3] += amt;
                balance[2] -= amt;
                
                tfr[3] += amt;
                tfr[2] -= amt;
                if(balance[3] > currentFRS)
                {
                    // more than FRS amount transfer to ordinary account.
                    amt = balance[3] - currentFRS;
                    balance[3] = currentFRS;
                    balance[0] += amt;
                    
                    tfr[3] -= amt;
                    tfr[0] += amt;
                }
             }
             else
             {
                // transfer to ordinary.
                balance[0] += amt;
                balance[2] -= amt;
                tfr[0] += amt;  
                tfr[2] -= amt;                      
             }
        }
    }
}
    
function Simulate()
{
    
    var myform = document.getElementById('simulator-form');
    
    // get the inputs.
    var SIMULATION_NAME = document.getElementById("inputName").value;
    var AGE = parseFloat(document.getElementById("inputAge").value);
    var SALARY = parseFloat(document.getElementById("inputSalary").value);
    var CASH = parseFloat(document.getElementById("inputCash").value);
    var BONUS_MONTHS = parseFloat(document.getElementById("inputBonus").value);
    var START_OA = parseFloat(document.getElementById("inputOA").value);
    var START_SA = parseFloat(document.getElementById("inputSA").value);
    var START_MA = parseFloat(document.getElementById("inputMA").value);
    var BHS_RATE = parseFloat(document.getElementById("inputBHSRate").value);
    var FRS_RATE = parseFloat(document.getElementById("inputFRSRate").value);
    var HOUSING = parseFloat(document.getElementById("inputHousing").value);
    var DPS = parseFloat(document.getElementById("inputDPS").value);
    var DPS_M = parseInt(document.getElementById("inputDPSM").value);
    var HPS = parseFloat(document.getElementById("inputHPS").value);
    var HPS_M = parseInt(document.getElementById("inputHPSM").value);
    var MEDISHIELD = parseFloat(document.getElementById("inputMedishield").value);
    var MEDISHIELD_M = parseInt(document.getElementById("inputMedishieldM").value);
    var ELDERSHIELD = parseFloat(document.getElementById("inputEldershield").value);
    var ELDERSHIELD_M = parseInt(document.getElementById("inputEldershieldM").value);
    var ALLOW_OA_SA_TFR = document.getElementById("allow_oa_sa").checked;
    
    function getProjectedValues(currentAge, currentBHS, currentFRS, numberOfYears, bhsRate, frsRate, allow)
    {
    	var data_collection = new Array();
    	var balance = [START_OA, START_SA, START_MA, 0];
        var age = currentAge;
        var RetirementAge = numberOfYears + currentAge;
        while(age <= RetirementAge)
        {            
            currentBHS = currentBHS*(1+bhsRate);
            
            if(age < 55)
            {
            	currentFRS = currentFRS*(1+frsRate);
            }
            
        	var con = [0, 0, 0, 0];
        	var ded = [0, 0, 0, 0];
        	var int = [0, 0, 0, 0];
        	var tfr = [0, 0, 0, 0];
            var bon = [BONUS_MONTHS, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
            var hse = HOUSING;
            var med = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
            var dps = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
            var hps = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
            var eds = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
            med[MEDISHIELD_M] = MEDISHIELD;
            eds[ELDERSHIELD_M] = ELDERSHIELD;
            dps[DPS_M] = DPS;
            dps[HPS_M] = HPS;
            
            for(var m = 0; m < 12; ++m)
            {
            	var contrib = getContrib(age, SALARY); 
            	balance[0] += contrib[0];
            	balance[1] += contrib[1];
            	balance[2] += contrib[2];
            	balance[3] += contrib[3];
                if(age < 55)
                {
                	if(balance[1] < currentFRS)
                	{
                		var amt = CASH;
                    	if(balance[1] + CASH > currentFRS)
                    	{
                    		amt = balance[1] + CASH - currentFRS;
                    	}
                		balance[1] += amt;
                    	tfr[1] += amt;
                	}
                }
                
                con[0] += contrib[0];
                con[1] += contrib[1];
                con[2] += contrib[2];
                con[3] += contrib[3];
                // Bonus -----------------------------------------------------------//
                if(bon[m] > 0)
                {
                	var bon_count = Math.floor(bon[m]);
                	for(var b = 0; b < bon_count; ++b)
                    {
                    	contrib = getContrib(age, bon[m]*SALARY);
        				balance[0] += contrib[0];
        				balance[1] += contrib[1];
        				balance[2] += contrib[2];
        				balance[3] += contrib[3];
                
                		con[0] += contrib[0];
                		con[1] += contrib[1];
                		con[2] += contrib[2];
                		con[3] += contrib[3];
                    }
                    var deci = bon[m] - bon_count;
                	contrib = getContrib(age, deci*SALARY);
        			balance[0] += contrib[0];
        			balance[1] += contrib[1];
        			balance[2] += contrib[2];
        			balance[3] += contrib[3];
                
                	con[0] += contrib[0];
                    con[1] += contrib[1];
                    con[2] += contrib[2];
                    con[3] += contrib[3];
                }
                // Deductions -----------------------------------------------------------//
                if(balance[0] > HOUSING)
                {
                	ded[0] += HOUSING;
        			balance[0] -= HOUSING;
                }
                else
                {
                	//alert("Not enough balance in OA to deduct housing.");
                    logtext = logtext + "Not enough balance in OA to deduct housing.<br>";
                }                
                
                ded[0] += dps[m];
        		balance[0] -= dps[m];
                ded[0] += hps[m];
        		balance[0] -= hps[m];
                ded[2] += med[m];
        		balance[2] -= med[m];
                ded[2] += eds[m];
        		balance[2] -= eds[m];
                
                // ALLOW_OA_SA_TFR
                if(age < 55)
                {
                	if(allow)
                    if(balance[1] < currentFRS)
                	{
                		var amt = balance[0];
                    	if(balance[1] + balance[0] > currentFRS)
                    	{
                    		amt = balance[1] + balance[0] - currentFRS;
                    	}
                		balance[1] += amt;
                   	 	tfr[1] += amt;
                		balance[0] -= amt;
                    	tfr[0] -= amt;
                	}
                }
                
                // Check for MA > BHS
                MAToSATransfer(age, balance, currentBHS, currentFRS, tfr);
                
                // Monthly floor interest calculations-----------------------------------//
                var oa_int = balance[0] * 0.025/12;
                int[0] += oa_int;
                var sa_int = balance[1] * 0.04/12;
                int[1] += sa_int;
                var ma_int = balance[2] * 0.04/12;
                int[2] += ma_int;
                var ra_int = balance[3] * 0.04/12;
                int[3] += ra_int;
            }
            
            // add the interest at the end of the year.
            balance[0] += int[0];
            balance[1] += int[1];
            balance[2] += int[2];
            balance[3] += int[3];
            
            // Check for MA > BHS after interest payment.            
        	MAToSATransfer(age, balance, currentBHS, currentFRS, tfr);
            
            // create RA at 55.
            if(age == 55)
            {
            	// RA is created.
                if(balance[1] + balance[0] > 5000.0)
                {
                	if(balance[1] > currentFRS)
                	{
                		balance[3] = currentFRS;
                    	balance[1] -= currentFRS;
                	}
                	else
                	{
                    	balance[3] = balance[1];
                    	balance[1] = 0.0;
                    	// remaining from OA.
                    	if(balance[0] > (currentFRS - balance[1]))
                    	{
                    		var bal = currentFRS - balance[1];
                    		balance[3] += bal;
                        	balance[0] -= bal;
                    	}
                    	else
                    	{
                        	balance[3] += balance[0];
                        	balance[0] = 0;     
                   	 	}
                	}
                }
                else
                {
                	balance[3] = 0.0;
                }
            }
            
            // add to data_collection.
        	data_collection.push(
            {
            	"age": age, 
                "BHS": currentBHS, 
                "FRS": currentFRS,
                "OA": [con[0], ded[0], int[0], balance[0], tfr[0]],
                "SA": [con[1], ded[1], int[1], balance[1], tfr[1]],
                "MA": [con[2], ded[2], int[2], balance[2], tfr[2]],
                "RA": [con[3], ded[3], int[3], balance[3], tfr[3]]
            });
            age += 1;
        }
        data_collection_array.push(data_collection);
        name_array.push(SIMULATION_NAME);
    }
    
    getProjectedValues(AGE, 68500.0, 198800, RetirementAge-AGE, BHS_RATE/100, FRS_RATE/100, ALLOW_OA_SA_TFR);
}

function Print_TotalBalances_New()
{
    var data_collection = data_collection_array[data_collection_array.length-1];
    var name = name_array[name_array.length - 1];

    
	var acc55 = [0, 0, 0, 0];
	var acc65 = [0, 0, 0, 0];
    var bhs55, bhs65, frs55;
    var oa_sa55 = 0;
    var oa_sa65 = 0;
    var oa_sa_ra55 = 0;
    var oa_sa_ra65 = 0;
    var total55 = 0;
    var total65 = 0;
    var withdraw_amt = 0;
	for(var i in data_collection)
    {
    	if(data_collection[i]["age"]==54)
        {
        	acc55[0] = data_collection[i]["OA"][3];
        	acc55[1] = data_collection[i]["SA"][3];
        	acc55[2] = data_collection[i]["MA"][3];
        	acc55[3] = data_collection[i]["RA"][3];
            bhs55 = data_collection[i]["BHS"];
            frs55 = data_collection[i]["FRS"];
            oa_sa55 = acc55[0] + acc55[1];
            oa_sa_ra55 = acc55[0] + acc55[1] + acc55[3];
            total55 = acc55[0] + acc55[1] + acc55[2] + acc55[3];
            withdraw_amt = oa_sa55 - frs55;
        }
    	if(data_collection[i]["age"]==64)
        {
        	acc65[0] = data_collection[i]["OA"][3];
        	acc65[1] = data_collection[i]["SA"][3];
        	acc65[2] = data_collection[i]["MA"][3];
        	acc65[3] = data_collection[i]["RA"][3];
            bhs65 = data_collection[i]["BHS"];
            oa_sa65 = acc65[0] + acc65[1];
            oa_sa_ra65 = acc65[0] + acc65[1] + acc65[3];
            total65 = acc65[0] + acc65[1] + acc65[2] + acc65[3];
        }
    } 
    
    var txt = document.getElementById('Print_TotalBalances55').innerHTML;
    txt =   "You will have <b class=\"text-primary\">" + 
            total55.toLocaleString("en-SG",{style:"currency", currency:"SGD"}) + 
            "</b> in your CPF accounts.<br>"; 
    document.getElementById('Print_TotalBalances55').innerHTML = txt;

    txt = document.getElementById('Print_TotalBalances65').innerHTML;

    txt =  "You will have <b class=\"text-primary\">" + 
            total65.toLocaleString("en-SG",{style:"currency", currency:"SGD"}) + 
            "</b> in your CPF accounts.<br>";  
    document.getElementById('Print_TotalBalances65').innerHTML = txt;

    txt =  "Your projected account balance would be " + 
            "<b class=\"text-danger\">" + acc55[0].toLocaleString("en-SG",{style:"currency", currency:"SGD"}) + "</b> in Ordinary Account (OA), " +
            "<b class=\"text-primary\">" + acc55[1].toLocaleString("en-SG",{style:"currency", currency:"SGD"}) + "</b> in Special Account (SA), and " +
            "<b class=\"text-warning\">" + acc55[2].toLocaleString("en-SG",{style:"currency", currency:"SGD"}) + "</b> in Medisave Account (MA). " +
            "The projected Full Retirement Sum based on the rate of increase you provided will be " + 
            "<b class=\"text-info\">" + frs55.toLocaleString("en-SG",{style:"currency", currency:"SGD"}) + " </b>" + 
            " and the maximum amount you could withdraw without a property pledge will be " + 
            "<b class=\"text-success\">" + withdraw_amt.toLocaleString("en-SG",{style:"currency", currency:"SGD"}) + ".</b>"; 
    
    document.getElementById('Print_TotalBalances55_Details').innerHTML = txt;

    txt =  "Your projected account balance would be " + 
            "<b class=\"text-danger\">" + acc65[0].toLocaleString("en-SG",{style:"currency", currency:"SGD"}) + "</b> in Ordinary Account (OA), " +
            "<b class=\"text-primary\">" + acc65[1].toLocaleString("en-SG",{style:"currency", currency:"SGD"}) + "</b> in Special Account (SA), " +
            "<b class=\"text-warning\">" + acc65[2].toLocaleString("en-SG",{style:"currency", currency:"SGD"}) + "</b> in Medisave Account (MA), and " +
            "<b class=\"text-info\">" + acc65[3].toLocaleString("en-SG",{style:"currency", currency:"SGD"}) + "</b> in Retirement Account (RA)." +
            "It assumes that you did not withdraw any money from your CPF from age 55 until 65. The RA amount is 4% compounded on the FRS fixed at 55.";
    
    document.getElementById('Print_TotalBalances65_Details').innerHTML = txt;

    
    if(chart_doughnut1 == null)
    {
        chart_doughnut1 = CreateDoughnutChart(document.getElementById('doughnut_TOTAL_BALANCES_55'), acc55, ['OA', 'SA', 'MA']);
        chart_doughnut1.update();  
    }
    if(chart_doughnut2 == null)
    {
        chart_doughnut2 = CreateDoughnutChart(document.getElementById('doughnut_TOTAL_BALANCES_65'), acc65, ['OA', 'SA', 'MA', 'RA']);
        chart_doughnut2.update(); 
    }
    
}

function CreateDoughnutChart(ctx, accdata, lbs)
{
    const data = {
        labels: lbs,
        datasets: [
            {
                label: 'Account information',
                data: accdata,
                backgroundColor: [
                    'rgb(255, 99, 132)',
                    'rgb(54, 162, 235)',
                    'rgb(255, 205, 86)'
                ],
                hoverOffset: 4
            }
        ]
    };
    const config = {
        type: 'doughnut',
        data: data,
        options: {
	        cutoutPercentage : 30,
            animateScale: true,
            maintainAspectRatio: true,
            responsive: true,
            layout: {
                padding: 0,
            },
            plugins: {
                legend: {
                    position: 'bottom',
                    align: 'start',
                },
                title: {
                    display: true,
                    text: 'Account Information'
                },
            },
            tooltips: 
            {
                enabled: true,
                mode: 'single',
                callbacks: 
                {
                    title: function(tooltipItems, data) 
                    {
                        return data['labels'][tooltipItems[0]['index']];
                    },
                    label: function(tooltipItems, data) 
                    {
                        return data['datasets'][0]['data'][tooltipItems['index']].toLocaleString("en-SG",{style:"currency", currency:"SGD"});
                    }
                }
            }
        },
    };
    var myDoughnut = new Chart(ctx, config);
    return myDoughnut;
}


function DrawChart_TotalBalances()
{    
	var labels = []; 
	var balances = [];
	var balances_oa_sa = [];
	var balances_ra = [];
    
	var n = data_collection_array.length-1;
    var data_collection = data_collection_array[data_collection_array.length-1];
	var name = name_array[n];
	for(var i in data_collection)
    {
        labels.push(data_collection[i]["age"]); 
        var value = 
        	data_collection[i]["OA"][3] + data_collection[i]["SA"][3] + 
            data_collection[i]["MA"][3] + data_collection[i]["RA"][3];
    	balances.push(
        {
        	x: data_collection[i]["age"], 
        	y: toFixed(value, 2)
        });
        
        var oa_sa = data_collection[i]["OA"][3] + data_collection[i]["SA"][3];
    	balances_oa_sa.push(
        {
        	x: data_collection[i]["age"], 
        	y: toFixed(oa_sa, 2)
        });
        
        var ra = data_collection[i]["RA"][3];
    	balances_ra.push(
        {
        	x: data_collection[i]["age"], 
        	y: toFixed(ra, 2)
        });
    }
    
	var newDataSet1 =
    {
    	label: name + " Total CPF Balance",
    	data: balances,
    	fill: false,
        
    	borderColor: getRandomColor(),
    	backgroundColor: getRandomColor(),
    	borderCapStyle: 'square',
        borderWidth: 2,
        pointRadius: 1.5
    };
    
	var newDataSet2 =
    {
    	label: name + " OA and SA Balance",
    	data: balances_oa_sa,
    	fill: false,
        
    	borderColor: getRandomColor(),
    	backgroundColor: getRandomColor(),
    	borderCapStyle: 'square',
        borderWidth: 2,
        pointRadius: 1.5
    };
    
	var newDataSet3 =
    {
    	label: name + " RA Balance",
    	data: balances_ra,
    	fill: false,
        
    	borderColor: getRandomColor(),
    	backgroundColor: getRandomColor(),
    	borderCapStyle: 'square',
        borderWidth: 2,
        pointRadius: 1.5
    };
    chart_total_balances.data.labels = labels;
    chart_total_balances.data.datasets.push(newDataSet1); 
    chart_total_balances.data.datasets.push(newDataSet2);  
    chart_total_balances.data.datasets.push(newDataSet3);   
    chart_total_balances.update();
}

function CreateChart_TotalBalances()
{
	if(chart_total_balances != null) return;
    
    var mydata = 
    {
    	labels: [],
        datasets: []
    };
	var ctx = document.getElementById('chart_TOTAL_BALANCES');    
	var chartOptions = 
    {
  		legend: 
        {
    		display: true,
    		position: 'bottom',
    		labels: 
        	{
     			boxWidth: 15,
      			fontColor: 'black'
    		}
  		},
		title: 
        {
			display: true,
			text: 'Total Account Balance Comparison'
		},
    	responsive: true,
        maintainAspectRatio: false,
        scales: 
        {
            yAxes: [
            {
                ticks: 
                {
                    beginAtZero: true,
                    callback: function(value, index, values) 
                    {                        
                        var ranges = 
                        [
                            { divider: 1e6, suffix: 'M' },
                            { divider: 1e3, suffix: 'k' }
                        ];
                        function formatNumber(n) 
                        {
                            for (var i = 0; i < ranges.length; i++) 
                            {
                                if (n >= ranges[i].divider) 
                                {
                                return (n / ranges[i].divider).toString() + ranges[i].suffix;
                                }
                            }
                            return n;
                        }
                        return '$' + formatNumber(value);
                    }
                }
            }]
        },
        tooltips: 
        {
            enabled: true,
            mode: 'single',
            callbacks: 
            {
                title: function(tooltipItems, data) 
                {
                    var label = data.datasets[tooltipItems[0].datasetIndex].label || '';
                    return label; //"Age: " + tooltipItems[0].xLabel;
                },
                label: function(tooltipItems, data) 
                {
                    var label = data.datasets[tooltipItems.datasetIndex].label || '';
                    if (label) 
                    {
                        label += ': ';
                    }
                    return " Age:" + tooltipItems.xLabel + " | " + 
                        tooltipItems.yLabel.toLocaleString("en-SG",{style:"currency", currency:"SGD"});
                }
            }
        }
	};
	chart_total_balances = new Chart(ctx, 
    {
    	type: 'line',
    	data: mydata,
    	options: chartOptions
	});
    document.getElementById('chart_TOTAL_BALANCES').style.display = "none"; 
}

function RunSimulation()
{
	data_collection_array = new Array();
    name_array = new Array();

    if(chart_doughnut1 != null)
    {
        chart_doughnut1.destroy();
        chart_doughnut1 = null;
    }

    if(chart_doughnut2 != null)
    {
        chart_doughnut2.destroy();
        chart_doughnut2 = null;
    }
    if(chart_total_balances != null)
    {
        chart_total_balances.data.datasets = [];   
        chart_total_balances.update();
    }
    
    document.getElementById("analysis_area").style.display = "none";

	CreateChart_TotalBalances();
	Simulate();   
    
    DrawChart_TotalBalances();
    Print_TotalBalances_New();    
    
    document.getElementById("analysis_area").style.display = "block";
    document.getElementById('chart_TOTAL_BALANCES').style.display = "block";  
    document.getElementById('doughnut_TOTAL_BALANCES_55').style.display = "block"; 
    document.getElementById('doughnut_TOTAL_BALANCES_65').style.display = "block"; 
}

function ClearAll()
{
	data_collection_array = new Array();
    name_array = new Array();

    if(chart_doughnut1 != null)
    {
        chart_doughnut1.destroy();
        chart_doughnut1 = null;
    }

    if(chart_doughnut2 != null)
    {
        chart_doughnut2.destroy();
        chart_doughnut2 = null;
    }
    if(chart_total_balances != null)
    {
        chart_total_balances.destroy();
        chart_total_balances = null;
    }
    
    document.getElementById("analysis_area").style.display = "none";
}

function CollapseInfo()
{
    var d = document.getElementById('collapseExample').style.display;
    if(d == "none")
    {
        document.getElementById('collapseExample').style.display = "block";
    }
    else
    {
        document.getElementById('collapseExample').style.display = "none";
    }
}

function CollapseInfo2()
{
    var d = document.getElementById('collapseExample2').style.display;
    if(d == "none")
    {
        document.getElementById('collapseExample2').style.display = "block";
    }
    else
    {
        document.getElementById('collapseExample2').style.display = "none";
    }
}

</script>

<div class = "container-md">
        <form id="simulator-form" class="needs-validation" method="post" novalidate="">
            <div class="card">
                <h6 class="card-header text-white bg-primary mb-3">Basic Inputs</h6>
                <div class="card-body">
                    <p class="card-text">Key in the basic parameters needed for the simulation.</p>
                    <hr>

                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label text-right " for="inputName">Simulation Name</label>
                        <div class="col-sm-7">
                            <input type="text" class="form-control" id="inputName" value="Simulation 1" required="">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label text-right" for="inputAge">Age</label>
                        <div class="col-sm-7">
                            <input type="number" class="form-control" id="inputAge" value="30" required="" min="18" max="65">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label text-right" for="inputSalary">Salary (SGD)</label>
                        <div class="col-sm-7">
                            <input type="number" class="form-control" id="inputSalary" value="3000.00" required="" step="0.01" min="500" max="6000">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label text-right" for="inputBonus">Bonus (months)</label>
                        <div class="col-sm-7">
                            <input type="number" class="form-control" id="inputBonus" value="1">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label text-right" for="inputCash">Monthly Top-up</label>
                        <div class="col-sm-7">
                            <input type="number" class="form-control" id="inputCash" value="0.00" required="" step="0.01" min="0.00" max="5000.00">
                        </div>
                    </div>
                </div>
            </div>
            <br>
            <div class="card">
                <div class="card-header  text-white bg-success"><h6>Starting Account Balance</h6></div>
                <div class="card-body">
                    <p class="card-text">Enter your CPF account balances. You can find this information from your CPF account.</p>
                    <hr>

                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label text-right" for="inputOA">Ordinary Account</label>
                        <div class="col-sm-7">
                            <input type="number" class="form-control" id="inputOA" value="0.00" required="" step="0.01" min="0.00" max="500000.00">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label text-right" for="inputSA">Special Account</label>
                        <div class="col-sm-7">
                            <input type="number" class="form-control" id="inputSA" value="0.00" required="" step="0.01" min="0.00" max="500000.00">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label text-right" for="inputMA">Medisave Account</label>
                        <div class="col-sm-7">
                            <input type="number" class="form-control" id="inputMA" value="0.00" required="" step="0.01" min="0.00" max="500000.00">
                        </div>
                    </div>
                </div>
            </div>
            <br>
            <div class="card">
                <div class="card-header text-white bg-secondary mb-3"><h6>BHS &amp; FRS Rates of Increase</h6></div>
                <div class="card-body">
                    <p class="card-text">Enter the expected growth rate of the Basic Healthcare Sum (BHS) and the Full Retirement Sum (FRS). A growth rate of 3-4% is a good choice.</p>
                    <hr>
                    
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label text-right">FRS Rate</label>
                        <div class="col-sm-7">
                            <select class="custom-select" id="inputFRSRate">
                                <option value="0.0">0.0</option>
                                <option value="0.5">0.5</option>
                                <option value="1.0">1.0</option>
                                <option value="1.5">1.5</option>
                                <option value="2.0">2.0</option>
                                <option value="2.5">2.5</option>
                                <option value="3.0">3.0</option>
                                <option value="3.5">3.5</option>
                                <option value="4.0">4.0</option>
                                <option value="4.5">4.5</option>
                                <option value="5.0">5.0</option>
                                <option value="5.5">5.5</option>
                                <option value="6.0">6.0</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label text-right">BHS Rate</label>
                        <div class="col-sm-7">
                            <select class="custom-select" id="inputBHSRate">
                                <option value="0.0">0.0</option>
                                <option value="0.5">0.5</option>
                                <option value="1.0">1.0</option>
                                <option value="1.5">1.5</option>
                                <option value="2.0">2.0</option>
                                <option value="2.5">2.5</option>
                                <option value="3.0">3.0</option>
                                <option value="3.5">3.5</option>
                                <option value="4.0">4.0</option>
                                <option value="4.5">4.5</option>
                                <option value="5.0">5.0</option>
                                <option value="5.5">5.5</option>
                                <option value="6.0">6.0</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <br>
            <div class="card">
                <div class="card-header  text-white bg-warning mb-3"><h6>Deductions</h6></div>
                <div class="card-body">
                    <p class="card-text">Enter the deductions from your CPF accounts. Typically this will be for housing, Medishield premium, ElderShield premium, Dependent Protection Scheme (DPS) premium and Home Protection Scheme (HPS) premium. By default, all these values are set to zero. You can change this and key in the exact amount, and the month it is deducted from your CPF.</p>
<hr>
                    <div class="form-group row ">
                        <label class="col-sm-3 col-form-label text-right" for="inputHousing">Housing</label>
                        <div class="col-sm-7">
                            <input type="number" class="form-control" id="inputHousing" value="0.00" required="" step="0.01" min="0" max="1500">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label text-right">DPS</label>
                        <div class="col-sm-4">
                            <input type="number" class="form-control" id="inputDPS" value="0.00" required="" step="0.01" min="0.00" max="500.00">
                        </div>
                        <div class="col-sm-3">
                            <select class="custom-select" id="inputDPSM">
                                <option value="1">January</option>
                                <option value="2">February</option>
                                <option value="3">March</option>
                                <option value="4">April</option>
                                <option value="5">May</option>
                                <option value="6">June</option>
                                <option value="7">July</option>
                                <option value="8">August</option>
                                <option value="9">September</option>
                                <option value="10">October</option>
                                <option value="11">November</option>
                                <option value="12">December</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label text-right">HPS</label>
                        <div class="col-sm-4">
                            <input type="number" class="form-control" id="inputHPS" value="0.00" required="" step="0.01" min="0.00" max="500.00">
                        </div>
                        <div class="col-sm-3">
                            <select class="custom-select" id="inputHPSM">
                                <option value="1">January</option>
                                <option value="2">February</option>
                                <option value="3">March</option>
                                <option value="4">April</option>
                                <option value="5">May</option>
                                <option value="6">June</option>
                                <option value="7">July</option>
                                <option value="8">August</option>
                                <option value="9">September</option>
                                <option value="10">October</option>
                                <option value="11">November</option>
                                <option value="12">December</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label text-right">Medishield</label>
                        <div class="col-sm-4">
                            <input type="number" class="form-control" id="inputMedishield" value="0.00" required="" step="0.01" min="0" max="2500">
                        </div>
                        <div class="col-sm-3">
                            <select class="custom-select" id="inputMedishieldM">
                                <option value="1">January</option>
                                <option value="2">February</option>
                                <option value="3">March</option>
                                <option value="4">April</option>
                                <option value="5">May</option>
                                <option value="6">June</option>
                                <option value="7">July</option>
                                <option value="8">August</option>
                                <option value="9">September</option>
                                <option value="10">October</option>
                                <option value="11">November</option>
                                <option value="12">December</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label text-right">Eldershield</label>
                        <div class="col-sm-4">
                            <input type="number" class="form-control" id="inputEldershield" value="0.00" required="" step="0.01" min="0" max="2500">
                        </div>
                        <div class="col-sm-3">
                            <select class="custom-select" id="inputEldershieldM">
                                <option value="1">January</option>
                                <option value="2">February</option>
                                <option value="3">March</option>
                                <option value="4">April</option>
                                <option value="5">May</option>
                                <option value="6">June</option>
                                <option value="7">July</option>
                                <option value="8">August</option>
                                <option value="9">September</option>
                                <option value="10">October</option>
                                <option value="11">November</option>
                                <option value="12">December</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <br>
            <div class="card">
                <div class="card-header text-white bg-info mb-3"><h6>Allow OA to SA Transfer</h6></div>
                <div class="card-body">
                    <p class="card-text">Finally, indicate whether or not you would allow the CPF simulator to automatically 
                        transfer your ordinary account balance to your special account until your FRS is reached. 
                        You can compare your CPF outputs based on allowed or not allowed settings. Try yourself 
                        and see the various outputs of the simulator. By default, this value is set to false.</p>
                    <hr>
                    <div class="form-group row">
                            <label class="col-sm-2">
                                <input type="radio" class="mr-1" name="allow_oa_to_sa" id="allow_oa_sa"> Yes
                            </label>
                            <label class="col-sm-2">
                                <input type="radio" class="mr-1" name="allow_oa_to_sa" checked="checked"> No
                            </label>
                    </div>

                    <div class="form-group">
                        <input type="button" class="btn btn-primary" value="Simulate" onclick="RunSimulation()">
                        <input type="button" class="btn btn-secondary" value="Reset All Simulations" onclick="ClearAll()">
                    </div>
                </div>
            </div>
        </form>
</div>

<div class="container-md" id="analysis_area" style="display: none;">
    <h5 class="card-header text-white bg-danger mb-3">Simulation Results</h5>

    <div class="card">
		<div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Just before your 55th birthday!</h5>                        
                            <div class="chart-container">
                                <canvas id="doughnut_TOTAL_BALANCES_55"></canvas>
                            </div>
                            <p class="card-text" id="Print_TotalBalances55"></p>
                            <!-- <a href="https://www.cpf.gov.sg/member/retirement-income/retirement-withdrawals/withdrawing-for-immediate-retirement-needs" class="btn btn-primary">Understand withdrawal options</a> -->
                            <div class="col text-center"><input type="button" class="btn btn-secondary" value="See Details" onclick="CollapseInfo()"></div>
                        </div>
                    </div>
                </div>
                <br>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Just before your 65th birthday!</h5>                        
                            <div class="chart-container">
                                <canvas id="doughnut_TOTAL_BALANCES_65"></canvas>
                            </div>
                            <p class="card-text" id="Print_TotalBalances65"></p>
                            <!-- <a href="https://www.cpf.gov.sg/member/infohub/be-ready/meeting-my-retirement-needs?utm_source=gle&utm_medium=sem&utm_campaign=brd" class="btn btn-primary">Meeting retirement needs</a> -->
                            <div class="col text-center"><input type="button" class="btn btn-secondary" value="See Details" onclick="CollapseInfo2()"></div>
                        </div>
                    </div>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-md-6">
                    <div class="card card-body" id="collapseExample" style="display: none">
                        <p class="card-text" id="Print_TotalBalances55_Details"></p>
                    </div>
                </div>
                <br>
                <div class="col-md-6">
                    <div class="card card-body" id="collapseExample2" style="display: none">
                        <p class="card-text" id="Print_TotalBalances65_Details"></p>
                    </div>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Account Balance Accumulation</h5>
                    
                            <p class="card-text">The below figure shows the total account balance for 
                                your CPF using two line graphs per simulation run. The first line graph shows the total account balance, 
                                which is the sum of the Ordinary, Special, Retirement and Medisave accounts. 
                                The second line graph shows the sum of the Ordinary and Special accounts. After 55, this becomes the amount you can withdraw after 
                                deducting the Full Retirement Sum.</p>
                                <div style=" height: 400px; width: 100%;">
                                    <canvas id="chart_TOTAL_BALANCES"></canvas>
                                </div>
                                <h6 class="card-title" id="Print_TotalBalances"></h6>
                        </div>
                    </div>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Assumptions</h5>
                            <p class="card-text">
                                <ul>
                                    <li>Bonus is added in the first month of the year.</li>
                                    <li>The additional 1% and extra additional 1% interest given by the
                                     government is not taken into the calculation.</li>
                                    <li>Interests are calculated on a monthly basis but added only at the end of the year.</li>
                                    <li>Once MA reaches BHS limit and age is less than 55 the contributions to Medisave and 
                                    interests from Medisave are transferred to SA. If SA reached FRS 
                                    limit then the amounts are transferred to OA.</li>
                                    <li>Once MA reaches BHS limit and age is more than 55 the contributions to Medisave
                                     and interests from Medisave are transferred to RA. If RA reached FRS limit 
                                     then the amounts are transferred to OA</li>
                                </ul>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Diclaimer</h5>
                    
                            <p class="card-text font-italic">I am not a financial advisor. Neither am I trying to sell you anything. 
                                This CPF simulator is for educational purposes. The calculations used in this simulator 
                                are derived from publicly available information. It projects the CPF account amounts 
                                based on the inputs you provide. No data is retained for the working of the simulator. 
                                The entire calculation takes place on the browser, and no information is sent to the server.
                                 If you find any problems or flaws, please send me a note via comments or email.</p>
                    
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>